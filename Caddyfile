{
	frankenphp {
		php_ini memory_limit 256M
		php_ini max_execution_time 120
		php_ini upload_max_filesize 50M
		php_ini post_max_size 50M
	}

	admin off

	{$CADDY_GLOBAL_OPTIONS}
}

{$SERVER_NAME:localhost} {
	root * /app/public

	encode zstd br gzip

	respond /health 200

	@static {
		path /assets/* /build/* /css/* /js/* /images/* /fonts/* /favicon.ico /robots.txt
		file
	}
	handle @static {
		file_server
		header Cache-Control "public, max-age=31536000, immutable"
	}

	@storage {
		path /storage/*
		file
	}
	handle @storage {
		file_server
	}

	php_server {
		try_files {path} index.php
	}

	header {
		X-Frame-Options "SAMEORIGIN"
		X-Content-Type-Options "nosniff"
		X-XSS-Protection "1; mode=block"
		Referrer-Policy "strict-origin-when-cross-origin"
		-Server
	}

	@sensitive {
		path /.env* /.git* /composer.* /package.* /.docker* /docker-compose* /Dockerfile* /Makefile
	}
	respond @sensitive 404

	log {
		output stdout
		format json
	}
}
